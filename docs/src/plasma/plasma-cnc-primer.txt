[[cha:plasma-primer]]

= Introducción al corte por plasma para usuarios de LinuxCNC
:toc:

== ¿Qué es el plasma?

El plasma es un cuarto estado de la materia; un gas ionizado que se ha calentado a una temperatura extremadamente alta e ionizado para que se vuelva eléctricamente conductor. Los procesos de descarnado y corte por arco de plasma utilizan este plasma para transferir un arco eléctrico a la pieza de trabajo. El metal que se va a cortar o quitar se derrite por el calor del arco y luego se remueve. Si bien el objetivo del corte con arco de plasma es la separación del material, el descarnado con arco de plasma se utiliza para eliminar metales a una profundidad y anchura controladas.

Las antorchas de plasma son similares en diseño a las bujías de los automoviles. Consisten en dos secciones, negativa y positiva, separadas por un aislante central. Dentro de la antorcha, el arco piloto comienza en el espacio entre el electrodo cargado negativamente y la boquilla cargada positivamente. Una vez que el arco piloto ha ionizado el gas de plasma, la columna de gas sobrecalentada fluye a través del pequeño orificio en la boquilla de la antorcha, que se enfoca en el metal a cortar.

En una antorcha de corte por plasma, un gas frío ingresa a la Zona B, donde un arco piloto entre el electrodo y la boquilla de la antorcha calienta e ioniza el gas. El arco de corte principal se transfiere luego a la pieza de trabajo a través de la columna de gas de plasma en la Zona C. Al forzar el plasma y el arco eléctrico a través de un pequeño orificio, la antorcha suministra una alta concentración de calor a un área pequeña. El arco de plasma rígido y restringido se muestra en la Zona C. Para el corte por plasma se usa la polaridad directa de corriente continua (CC), como se muestra en la ilustración. La zona A canaliza un gas secundario que enfría la antorcha. Este gas también ayuda al gas de plasma de alta velocidad a expulsar el metal fundido del corte, permitiendo un corte rápido y sin escoria.

image::images/primer_torch-head.png[width=400]

== Inicialización de arco

Hay dos métodos principales para la inicialización del arco.

=== Inicio de alta frecuencia

Este tipo de inicio es ampliamente empleado y ha sido el más vigente. Aunque es una tecnología más antigua, funciona bien y arranca rápidamente. Pero, debido a la potencia de alto voltaje y alta frecuencia que se requiere para ionizar el aire, tiene algunos inconvenientes. A menudo interfiere con los circuitos electrónicos circundantes e incluso puede dañar los componentes. También se necesita un circuito especial para crear un arco piloto. Los modelos de bajo costo no tienen un arco piloto, y requieren tocar el consumible para comenzar el trabajo. El empleo de un circuito de HF también puede aumentar los problemas de mantenimiento, ya que generalmente hay puntos ajustables que deben limpiarse y reajustarse de vez en cuando.

=== Inicio Blowback

Este tipo de arranque utiliza la presión de aire suministrada al cortador para forzar un pequeño pistón o cartucho dentro de la cabeza de la antorcha hacia atrás para crear un pequeño arranque entre la superficie interior del consumible, ionizando el aire y creando una pequeña llama de plasma. Esto también crea un "arco piloto" que proporciona una llama de plasma que permanece encendida, se esté en contacto con el metal o no. Este es un muy buen tipo de inicio que ahora utilizan varios fabricantes. Su ventaja es que requiere menos circuitos, es bastante confiable y genera mucho menos ruido eléctrico.


Para los sistemas CNC básicos de plasma de aire, se prefiere con mucho el estilo blowback para minimizar la interferencia eléctrica con la electrónica y las PC estándar, pero el arranque de alta frecuencia sigue siendo el elegido en máquinas grandes de 200 amperios o más. Esto requiere dispositivos electrónicos y PC's de nivel industrial e incluso los fabricantes comerciales han tenido problemas con fallos porque no han tenido en cuenta el ruido eléctrico en sus diseños.

== Plasma CNC

Las operaciones de plasma en máquinas CNC son bastante peculiares en comparación con el fresado o torneado y es un proceso un tanto huérfano. El calentamiento desigual del material del arco de plasma hará que la plancha se pandee y se doble. La mayoría de las planchas de metal no salen en su fabricación en un estado muy uniforme o plano. Las hojas gruesas (más de 30 mm) pueden estar fuera de plano hasta 50 mm o 100 mm. La mayoría de las operaciones del Código G del CNC comenzarán a partir de una referencia conocida o un bloque de material que tiene un tamaño y forma conocidos y el Código G se escribe para desbastar el exceso y finalmente cortar la parte terminada. Con el plasma, el estado desconocido de la hoja hace que sea imposible generar un código G que satisfaga estas variaciones en el material.

En arco de plasma tiene forma ovalada y la altura de corte debe controlarse para minimizar los bordes biselados. Si la antorcha está demasiado alta o demasiado baja, los bordes pueden quedar excesivamente biselados. También es crítico que la antorcha se mantenga perpendicular a la superficie.

*La distancia de la antorcha al trabajo puede afectar la angularidad*

image::images/primer_cut-angularity.png[width=400]

*Ángulo de corte negativo:* antorcha demasiado baja; aumente la distancia de la antorcha al trabajo.

*Ángulo de corte positivo:* antorcha demasiado alta; disminuir distancia de la antorcha al trabajo.

NOTA: Una ligera variación en los ángulos de corte puede ser normal, siempre que esté dentro de la tolerancia.

La capacidad de controlar con precisión la altura de corte en un entorno tan hostil y siempre cambiante es un desafío muy difícil. Afortunadamente, existe una relación muy lineal entre la altura de la antorcha (longitud del arco) y el voltaje del arco, como muestra este gráfico.

image::images/primer_volts-height.png[width=600]

Este gráfico se preparó a partir de una muestra de aproximadamente 16000 lecturas a diferentes alturas de corte y el análisis de regresión muestra 7,53 voltios por mm con un 99,4% de confianza. En este caso particular, esta muestra fue tomada de una máquina Everlast 50 amp controlada por Linuxcnc.

El voltaje de la antorcha se convierte en una variable de control de proceso ideal para ajustar la altura de corte. Supongamos por simplicidad que el voltaje cambia en 10 voltios por mm. Esto se puede restablecer a 1 voltio por 0,1 mm (0.04”).
Los principales fabricantes de máquinas de plasma (por ejemplo, Hypertherm, Thermal Dynamics y ESAB) dan tablas de corte que especifican la altura de corte recomendada y el voltaje de arco estimado a esta altura, así como algunos datos adicionales. Por tanto, si el voltaje del arco es 1 voltio más alto que la especificación del fabricante, el controlador simplemente necesita bajar la antorcha 0,1 mm (0.04 ”) para regresar a la altura de corte deseada. Para administrar este proceso se usa tradicionalmente una unidad de control de altura de la antorcha (THC).

== Tipos de control de altura de antorcha

La mayoría de las unidades THC son dispositivos externos y muchas tienen un método de ajuste bastante burdo. Proporcionan dos señales de información al controlador LinuxCNC. Una se activa si el eje Z debe moverse hacia arriba y la otra, si el eje Z debe moverse hacia abajo. Ninguna señal se activa si la antorcha está a la altura correcta. El popular Proma 150 THC es un ejemplo de este tipo de THC. El componente de Linuxcnc THCUD está diseñado para funcionar con este tipo de THC.

Con el lanzamiento de la interfaz Mesa THCAD de voltaje a frecuencia, LinuxCNC pudo decodificar el voltaje real de la antorcha a través de una entrada de codificador. Esto permitió que LinuxCNC controlara el eje Z y eliminara el hardware externo. Las primeras implementaciones que utilizan THCAD replicaron el enfoque de "bit bang". El componente Linuxcnc THC es un ejemplo de este enfoque.

Jim Colt, de Hypertherm, dice que los mejores controladores de THC estaban completamente integrados en el controlador CNC. Por supuesto, se refería a los sistemas de gama alta fabricados por Hypertherm, Esab, Thermal Dynamics y otros, como Advanced Robotic Technology en Australia, sin soñar que el código abierto podría producir sistemas utilizando este enfoque que rivaliza con los sistemas de gama alta.

La inclusión de offsets externos en Linuxcnc V2.8 permitió que el control de plasma en LinuxCNC se elevara a un nivel completamente nuevo. Los offsets externos se refieren a la capacidad de aplicar un offset a la posición ordenada del eje externo al controlador de movimiento. Esto es perfecto para el control del THC como un método para ajustar la altura de la antorcha en tiempo real según nuestra metodología de control de proceso elegida. Después de una serie de compilaciones experimentales, la configuración <<cha:plasmac-user-guide,PlasmaC>> se incorporó a la rama master LinuxCNC (v2.9). Este ha sido un proyecto extremadamente ambicioso y muchas personas en todo el mundo han participado en las pruebas y la mejora del conjunto de características. PlasmaC es único en el sentido de que su objetivo de diseño era admitir todos los THC, incluidos los de simple bit bang, hasta el sofisticado control de voltaje de la antorcha si el voltaje está disponible para LinuxCNC a través de un THCAD o algún otro sensor de voltaje. Además, PlasmaC está diseñado para ser un sistema independiente que no necesita ninguna subrutina adicional de código G y permite al usuario definir sus propias tablas de corte que están almacenadas en el sistema y accesibles mediante un menú desplegable.

== Señal de arco correcto

Las máquinas de plasma que tienen una interfaz CNC incorporan un conjunto de contactos (por ejemplo, relés) que se cierran cuando se establece un arco válido y cada lado de estos contactos se emparejan con pines en la interfaz CNC. Un constructor de mesas de plasma debe conectar un lado de estos pines a la alimentación de campo y el otro a un pin de entrada. Esto permite que el controlador CNC sepa cuándo se establece un arco válido y también cuándo se pierde el arco inesperadamente. Aquí hay una trampa potencial cuando la entrada es un circuito de alta impedancia, como una tarjeta Mesa. Si los contactos son relés simples, existe una alta probabilidad de que la corriente que pasa a través del relé sea menor que la especificación de corriente mínima. En estas condiciones, los contactos del relé pueden sufrir una acumulación de óxido que con el tiempo puede dar como resultado una operación de contacto intermitente. Para evitar que esto suceda, se debe instalar una resistencia pull-down en el pin de entrada del controlador. Se debe tener cuidado en garantizar que esta resistencia se seleccione para que la corriente mínima pase a través del relé y tenga la potencia suficiente para manejar la potencia en el circuito. Finalmente, la resistencia debe montarse de tal manera que el calor generado no dañe nada mientras esté en funcionamiento.

== Detección de altura inicial

Debido a que la altura de corte es un parámetro tan crítico del sistema y la superficie del material es inherentemente desigual, el mecanismo del eje Z necesita un método para detectar la superficie del material. Hay tres métodos que pueden lograr esto; Sensado de corriente para detectar un mayor par motor, un interruptor "flotante" y un circuito de detección eléctrico u "óhmico" que se cierra cuando el protector de la antorcha entra en contacto con el material. El sensado de corriente no es una técnica viable para las mesas DIY, por lo que se analizan a continuación los interruptores flotantes y la detección óhmica:

=== Interruptores flotantes

La antorcha está montada sobre una plataforma deslizante que puede moverse hacia arriba cuando la boquilla de la antorcha hace contacto con la superficie del material y activa un interruptor o sensor. A menudo, esto se logra bajo el control del Código G utilizando los comandos G38 (sonda). Si este es el caso, despues de la prueba inicial, se recomienda sondear lejos de la superficie hasta que la señal de la sonda se pierda a una velocidad más lenta. Además, asegúrese de que se tenga en cuenta la histéresis del interruptor.

Independientemente de qué método de sondeo se implemente, se recomienda encarecidamente que se implemente el interruptor flotante para que haya una señal fallback o secundaria para evitar daños a la antorcha debido a un choque.

[[ohmic-sensing]]

=== Detección óhmica

La detección óhmica se basa en el contacto entre la antorcha y el material que actúa como un interruptor para activar una señal eléctrica que es detectada por el controlador CNC. Siempre que el material esté limpio, este puede ser un método mucho más preciso de detectar el material ya que un interruptor flotante puede causar deflexion de la superficie del material. Este circuito de detección óhmico está funcionando en un entorno extremadamente hostil, por lo que es necesario implementar una serie de mecanismos de seguridad para garantizar la seguridad tanto de la electrónica del CNC como del operador. En el corte por plasma, la pinza de tierra unida al material es positiva y la antorcha es negativa. Se recomienda que:

. La detección óhmica solo se implementará cuando la antorcha tenga un escudo aislado de la boquilla de la antorcha que transporta el arco de corte.
. El circuito óhmico utiliza una fuente de alimentación aislada totalmente separada que activa un relé optoaislado para permitir que la señal de prueba se transmita al controlador CNC.
. El lado positivo del circuito debe estar en la antorcha.
. Ambos lados del circuito deben aislarse mediante relés optoaislados hasta que se realice el sondeo.
. Se deben usar diodos de bloqueo para evitar que el voltaje del arco ingrese al circuito de detección óhmico.

Lo siguiente es un circuito de ejemplo que se ha demostrado que funciona y es compatible con la configuración de Linuxcnc PlasmaC.

imagen::images/primer_ohmic-sensing.png[width=1000]

== Retraso THC

Cuando se establece un arco, el voltaje del arco alcanza un pico significativo y luego se estabiliza a un voltaje estable a la altura de corte. Esto se muestra por la línea verde en la imagen a continuación.

imagen::images/primer_thc-delay.png[width=1000]

Es importante que el controlador de plasma "espere" antes de comenzar el control de THC. Si se habilita demasiado pronto, el voltaje estará por encima de los voltios de corte deseados y la antorcha se bajará en un intento de abordar una condición  percibida de sobre-altura.

En nuestras pruebas, esto varía entre máquinas y material de 0.5 a 1.5 segundos. Por lo tanto, un retraso de 1.5 segundos después de que se reciba una señal de arco OK válida antes de habilitar el control de THC es una configuración inicial segura. Si desea acortar esto para un material dado, el Halscope de LinuxCNC le permitirá trazar el voltaje de la antorcha y tomar decisiones informadas sobre el menor retraso seguro que se utiliza.


NOTA: Si la velocidad de corte no está cerca de la velocidad de corte deseada al final de este retraso, el controlador debe esperar hasta que esto se logre antes de habilitar el THC.

== Muestreo de voltaje de antorcha

En lugar de confiar en las tablas de corte del fabricante para establecer el voltaje de la antorcha deseado, muchas personas (incluido el que escribe) prefieren probar el voltaje a medida que el THC está habilitado y usarlo como punto de ajuste.

== ruptura de antorcha

Se recomienda encarecidamente que se instale un mecanismo para permitir que la antorcha "rompa" o se caiga en caso de impacto con el material o una parte cortada que se haya volcado. Debe instalarse un sensor para permitir que el controlador CNC detecte si esto ha ocurrido y pause el programa en ejecución. Por lo general, esto se implementa utilizando imanes para asegurar la antorcha al eje Z.

== Bloqueo de bajada en esquinas por velocidad

El planificador de trayectoria Linuxcnc es responsable de traducir los comandos de velocidad y aceleración en movimientos que obedecen las leyes de la física. Por ejemplo, el movimiento se ralentizará al negociar una esquina. Si bien esto no es un problema con las fresadoras o enrutadores, esto plantea un problema particular para el corte por plasma ya que el voltaje del arco aumenta a medida que el movimiento disminuye. Esto hará que el THC baje la antorcha. Una de las enormes ventajas de un control THC integrado en el controlador de movimiento LinuxCNC es que sabe lo que está sucediendo en todo momento. Por lo tanto, se convierte en una cuestión trivial controlar la velocidad actual (motion.current-speed) y mantener la operación de THC si cae por debajo de un umbral establecido (por ejemplo, 10% por debajo de la velocidad de avance deseada.

== Cruzando vacío/Kerf

Si la antorcha de plasma pasa sobre un vacío durante el corte, el voltaje del arco aumenta rápidamente y el THC responde con un movimiento violento hacia abajo que puede hacer chocar la antorcha en el material y dañarla. Esta es una situación que es difícil de detectar y manejar. Hasta cierto punto, puede mitigarse con buenas técnicas de anidación, pero aún puede ocurrir en materiales más gruesos cuando cae un recorte. Este es el único problema que aún no se ha resuelto dentro del movimiento de código abierto LinuxCNC.

Una técnica sugerida es monitorear la tasa de cambio en los voltios de la antorcha a lo largo del tiempo (dv/dt) porque este parámetro es de orden de magnitud mayor al cruzar un vacío que lo que ocurre debido a la deformación normal del material. La siguiente imagen muestra una gráfica de baja resolución de dv/dt (en azul) mientras se cruza un vacío. La curva roja es un promedio móvil de voltios de antorcha.

imagen::images/primer_kerf-cross.png[width=600]

Por lo tanto, debería ser posible comparar el promedio móvil con dv/dt y detener la operación de THC cuando dv/dt exceda el rango normal esperado debido a la deformación. Se necesita más trabajo en esta área para encontrar una solución de trabajo en LinuxCNC.

== Agujeros y cortes pequeños

Se recomienda reducir la velocidad de corte al cortar agujeros y formas pequeñas.

John Moore dice: “Si desea detalles sobre el corte de agujeros pequeños y precisos, consulte las hojas de ventas de la "Tecnología True Hole" de Hypertherm y también vea PlasmaSpider, el usuario Seanp ha publicado mucho sobre su trabajo utilizando plasma de aire simple.

El método generalmente aceptado para obtener buenos agujeros de 37 mm de diámetro. y hasta el grosor del material con un mínimo cono usando un plasma de aire es:

. Use la corriente de corte recomendada para los consumibles.
. Utilice la altura de corte recomendada fija (sin THC) para los consumibles.
. Corte del 60% al 70% de la tasa de alimentación recomendada de los consumibles y el material.
. Inicie en o cerca del centro del agujero.
. Use entrada perpendicular.
. No haga salida; mejor una ligera quemadura o un apagado temprano de antorcha, dependiendo de lo que funcione mejor para usted.

Tendrá que experimentar para obtener el tamaño exacto del agujero porque el corte con este método será más ancho que su corte recto habitual".

Esta ralentización se puede lograr manipulando la velocidad de alimentación directamente en su postprocesador o utilizando alimentación adaptativa y un pin analógico como entrada. Esto le permite usar M67/M68 para establecer el porcentaje de alimentación deseada para cortar.

- Conociendo el avance

De la discusión anterior es evidente que el controlador de plasma necesita conocer la velocidad de alimentación establecida por el usuario. Esto plantea un problema con LinuxCNC porque LinuxCNC no guarda el avance después de que el G-Code se almacena y analiza. Hay dos enfoques para solucionar esto:

. Vuelva a asignar el comando F y guarde la velocidad de avance ordenada establecida en G-Code a través de un comando M67/M68
. Almacenar las tablas de corte en el controlador de plasma y permitir que el programa G-Code consulte el avance actual (como lo hace PlasmaC)

Una rama experimental de Linuxcnc que sería útil para el corte por plasma sería la rama de etiquetas de estado. Esto agrega una "etiqueta" que está disponible para el movimiento que contiene las velocidades de avance y velocidad actuales para todos los comandos de movimiento activos. Esperamos ver esto implementado por los desarrolladores de LinuxCNC en la versión 2.9.

== Pines de E/S para controladores de plasma

Las cortadoras de plasma requieren varios pines adicionales. En LinuxCNC, no hay reglas estrictas sobre qué pin hace qué. En esta discusión asumiremos que el inverter de plasma tiene una interfaz CNC y que la tarjeta controladora tiene entradas activas altas (por ejemplo, Mesa 7i76e).

Las mesas de plasma pueden ser máquinas grandes y le recomendamos que se tome el tiempo de instalar interruptores de límite máximo/mínimo e interruptores home  separados para cada articulacion. La excepción podría ser el límite inferior del eje Z. Cuando se activa un interruptor home, la articulación se desacelera bastante lentamente para obtener la máxima precisión. Esto significa que si desea utilizar velocidades de referencia que sean proporcionales al tamaño de la tabla, puede sobrepasar el punto de activación inicial en 50-100 mm. Si usa un interruptor de límite/home compartido, debe mover el sensor fuera del punto de activación con el HOME_OFFSET final o activará una falla del interruptor de límite cuando la máquina salga de la referencia. Esto significa que podría perder 50 mm o más de recorrido del eje con los interruptores de home/límite de fragmentos. Esto no sucede si se usan interruptores home y límite separados.

Por lo general, se requieren los siguientes pines (tenga en cuenta que las conexiones sugeridas pueden no ser apropiadas para una configuración de PlasmaC):

=== Arco OK (entrada)

* El inversor cierra los contactos cuando se establece un arco válido.
* Conecte la alimentación de campo a un terminal Inverter ArcOK.
* Conecte otro Terminal Inverter Ok al pin de entrada.
* Usualmente conectado a uno de los pines 'motion.digital- <nn>' para usar desde G-Code con M66

=== Antorcha encendida (salida)

* Activa un relé para cerrar la antorcha en el interruptor en el inversor
* Conecte la antorcha en los terminales del inversor a los terminales de salida del relé
* Conecte un lado de la bobina al pin de salida
* Conecte el otro lado de la bobina a tierra de Field Power.
* Si se utiliza un relé mecánico, conecte un diodo flyback (por ejemplo, serie IN400x) a través de los terminales de la bobina con la banda del diodo apuntando hacia el pin de salida
* Si se utiliza un relé de estado sólido, puede ser necesario observar la polaridad en las salidas
* En algunas circunstancias, se puede usar el relé de eje integrado en una tarjeta Mesa en lugar de un relé externo.
* Generalmente conectado a 'motion.spindle.0.on'

ADVERTENCIA: Se recomienda encarecidamente que la antorcha no se pueda activar mientras este pin sea falso; de lo contrario, la antorcha no se apagará cuando se presione el tope;

=== Interruptor flotante (entrada)

* Utilizado para sondeo de superficie. Un sensor o interruptor que se activa si la antorcha se desliza hacia arriba cuando golpea el material.
* Conecte la salida del sensor de proximidad al pin de entrada elegido. Si se utilizan interruptores mecánicos, conecte un lado del interruptor a la alimentación de campo y el otro lado del interruptor a la entrada.
* Generalmente conectado a 'motion.probe-input'


=== Activación del sensor óhmico (salida)

* Vea el esquema de <<ohmic-sensing,detección óhmica>>.
* Conecte el pin de salida a un lado de los relés de aislamiento y el otro lado a la toma de tierra.
* En una configuración que no sea PlasmaC, generalmente activada por un 'motion.digital-out- <nn>' para que M62/M63/M64/M65 pueda controlarlo en G-Code


=== Detección óhmica (entrada)

* Tenga cuidado de seguir el esquema de <<ohmic-sensing,detección óhmica>> mostrado anteriormente.
* Una fuente de alimentación aislada activa un relé cuando el protector de la antorcha hace contacto con el material.
* Conecte la potencia de campo a un terminal de salida y el otro a la entrada.
* Tenga cuidado de observar la polaridad del relé si se utilizan relés de estado sólido optoacoplados.
* Por lo general, está conectado a 'motion.probe-input' y puede conectarse con el interruptor flotante.

Como se puede ver, las tablas de plasma son intensivas en pines y ya hemos consumido alrededor de 15 entradas antes de que se agreguen los estops normales. Otros tienen otros puntos de vista, pero es la opinión del autor que la Mesa 7i76e es preferible a la más barata 7i96 para permitir el cambio de selección de MPG, escala y eje y otras características que puede agregar con el tiempo. Si su mesa usa servos, hay varias alternativas. Si bien hay otras alternativas, el diseño de su máquina alrededor del ecosistema de Mesa simplificará el uso de su placa THCAD para leer el voltaje del arco.

=== Ruptura de la antorcha

* Como se mencionó anteriormente, se debe instalar un sensor de ruptura que se dispara si la antorcha se estrella y se cae.
* Por lo general, esto se conectaría a 'halui.program-pause' para que el fallo se pueda corregir y reanudar el programa.


== Código G para controladores de plasma

La mayoría de los controladores de plasma ofrecen un método para cambiar la configuración de G-Code. Linuxcnc admite esto a través de M67/M68 para comandos analógicos y M62-M65 para digitales (comandos de encendido/apagado). El cómo se implementa esto es totalmente arbitrario. Veamos cómo la configuración de LinuxCNC PlasmaC hace esto:

=== Seleccione la configuración del material en PlasmaC y use la velocidad de avance para ese material:

----
M190 Pn
M66 P3 L3 Q1
F#<_hal[plasmac.cut-feed-rate]>
M3 S1
----

NOTA: Los usuarios con una gran cantidad de entradas en la tabla de materiales de PlasmaC pueden necesitar aumentar el parámetro Q1 (por ejemplo, Q2)

=== Activar/desactivar la operación de THC:

----
M62 P2 desactivará THC (sincronizado con movimiento)
M63 P2 habilitará THC (sincronizado con movimiento)
M64 P2 desactivará el THC (inmediatamente)
M65 P2 habilitará THC (inmediatamente)
----

=== Reduzca las velocidades de corte: (por ejemplo, para cortar agujeros)

----
M67 E3 Q0 establecería la velocidad al 100% de la velocidad solicitada
M67 E3 Q40 establecería la velocidad al 40% de la velocidad solicitada
M67 E3 Q60 establecería la velocidad al 60% de la velocidad solicitada
M67 E3 Q100 establecería la velocidad al 100% de la velocidad solicitada
----

=== Compensación del cortador:

----
G41.1 D#<_ hal [plasmac_run.kerf-width-f]>; para la izquierda de la ruta programada
G42.1 D#<_ hal [plasmac_run.kerf-width-f]> para la derecha de la ruta programada
G40 para desactivar compensación
----

NOTA: Los integradores deben familiarizarse con la documentación de Linuxcnc para los diversos comandos de G-Code Linuxcnc mencionados anteriormente.

== Offsets externos y corte por plasma

Los offsets externos se introdujeron en Linuxcnc con la versión 2.8. Por externo entenderemos que podemos aplicar un offset externo al Código G del que el planificador de trayectorias no sabe nada. Es más fácil de explicar con un ejemplo. Imagine un torno con un desplazamiento externo aplicado por una fórmula matemática para mecanizar un lóbulo en una leva. Por lo tanto, el torno gira a ciegas con el diámetro de corte establecido en un diámetro fijo y el desplazamiento externo mueve la herramienta hacia adentro y hacia afuera para mecanizar el lóbulo de la leva a través de un desplazamiento externo aplicado. Para configurar nuestro torno para mecanizar esta leva, necesitamos asignar una parte de la velocidad y aceleración del eje a desplazamientos externos o la herramienta no podrá moverse. Aquí es donde entra en juego la variable ini OFFSET_AV_RATIO. Digamos que decidimos que necesitamos asignar el 20% de la velocidad y la aceleración al desplazamiento externo al eje Z. Establecemos esto igual a 0,2. La consecuencia de esto es que su velocidad y aceleración máximas para el eje Z del torno es solo el 80% de lo que podría ser.

Los offsets externos son un método muy poderoso para hacer ajustes de altura de la antorcha al eje Z a través de un THC. Pero el plasma tiene que ver con las altas velocidades y la aceleración rápida, por lo que no tiene sentido limitar estos parámetros. Afortunadamente, en una máquina de plasma, el eje Z está 100% controlado por el THC o no lo está. Durante el desarrollo de los offsets externos de Linuxcnc se reconoció que el movimiento del eje Z por G-Code y por THC eran mutuamente excluyentes. Esto nos permite engañar a los offsets externos para que den el 100% de la velocidad y la aceleración todo el tiempo. Podemos hacer esto duplicando la configuración de velocidad y aceleración del eje Z de la máquina en el archivo ini y establecer OFFSET_AV_RATIO=0,5. De esa manera, el 100% de la velocidad y aceleración máximas estarán disponibles tanto para sondeo como para THC.

Ejemplo:
En una máquina métrica con un motor NEMA23 con accionamiento directo a un tornillo de bolas de 5 mm, se determinó que la velocidad máxima de 60 mm/segundo y la aceleración de 700 mm/seg/seg eran valores seguros sin pérdida de pasos. Para esta máquina, configure el eje Z en el archivo ini de la siguiente manera:

----
[AXIS_Z]
OFFSET_AV_RATIO = 0.5
MAX_VELOCITY = 120
MAX_ACCELERATION = 1400
----

La unión asociada con este eje tendría las variables de velocidad y aceleración establecidas de la siguiente manera:

----
[JOINT_n]
MAX_VELOCITY = 60
MAX_ACCELERATION = 700
----

Para obtener más información sobre los offsets externos (para V 2.8 y superior), lea la <<sec:axis-section,Sección [AXIS_ <letter>]>> del documento del archivo INI y <<cha:external-offsets,offsets externos de eje>> en la documentación de Linuxcnc.

== Lectura de voltaje de arco con Mesa THCAD

La tarjeta Mesa THCAD es un convertidor de voltaje a frecuencia notablemente bien valorado y preciso que está diseñado para el entorno hostil eléctricamente ruidoso asociado con el corte por plasma. Internamente tiene un rango de 0-10 voltios. Este rango se puede ampliar simplemente agregando algunas resistencias como se describe en la documentación. Esta placa está disponible en dos versiones, el THCAD-10 con un rango de 0-10 voltios y el THCAD-300 que está precalibrado para un rango extendido de 300 voltios. Cada placa se calibra individualmente y se aplica una etiqueta adhesiva a la placa que indica la frecuencia a 0 voltios y a escala completa. Para usar con LinuxCNC, se recomienda que el divisor 1/32 sea seleccionado por el enlace apropiado en la placa. En este caso, asegúrese de dividir también las frecuencias establecidas por 32. Esto es más apropiado para la servo thread de 1 kHz y también le da más tiempo al THCAD para promediar y suavizar la salida.

Hay mucha confusión acerca de cómo decodificar la salida THCAD, así que consideremos la Mesa 7i76e y la THCAD-10 en este momento con los siguientes datos de calibración hipotéticos:

* Escala completa 928.000 Hz (1/32 29.000 Hz)
* 0 voltios 121.600 Hz (1/32 3.800 Hz)

Debido a que la escala completa es de 10 voltios, entonces la frecuencia por voltio es:

----
(29000 - 3800) / 10 = 2520 Hz por voltio
----

Asumiendo que tenemos una entrada de 5 voltios, la frecuencia calculada sería:

----
(2520 * 5) + 3.800 = 16.400
----

Entonces, ahora debería quedar bastante claro cómo convertir la frecuencia a su voltaje equivalente:

----
Voltios = (frecuencia - 3800) / 2520
----

=== Conexiones THCAD

En el lado de alto voltaje:

* Conecte el voltaje de arco dividido o en bruto a IN + e IN-
* Conecte el blindaje del cable de interconexión a la conexión del blindaje.
* Conecte el otro terminal del escudo a la tierra del bastidor.

Suponiendo que esté conectado a un 7i76e, conecte la salida a la entrada del codificador de husillo:

* THCAD + 5v a TB3 Pin 6 (+5 VP)
* THCAD -5v a TB3 Pin 1 (GND)
* THCAD FOUT+ a TB3 Pin 7 (ENC A+)
* THCAD FOUT- a TB3 Pin 8 (ENC A-)

=== Prueba inicial de THCAD

Asegúrese de tener las siguientes líneas en su archivo ini (suponiendo una Mesa 7i76e):
----
setp hm2_7i76e.0.encoder.00.scale -1
setp hm2_7i76e.0.encoder.00.counter-mode 1
----

Encienda su controlador y abra Halshow (Axis: Mostrar configuración homing), profundice para encontrar el 'hm2_7i76e.0.encoder.00.velocity pin'. Con 0 voltios aplicados, debería estar rondando la frecuencia de 0 voltios (3.800 en nuestro ejemplo). Tome una batería de 9 voltios y conéctela a IN + e IN-. Para un THCAD-10 ahora puede calcular la velocidad esperada. (26,480 en nuestro ejemplo hipotético). Si pasa esta prueba, entonces está listo para configurar su controlador de plasma LinuxCNC.

=== Qué modelo THCAD usar

No hay duda de que el THCAD-10 es el dispositivo más flexible y es fácil de modificar la escala. Sin embargo, hay una advertencia que puede entrar en juego con algunos cortadores de plasma más baratos con un divisor de voltaje incorporado. Es decir, las resistencias internas pueden ser percibidas por el THCAD como parte de su propia resistencia externa y devolver resultados erróneos. Por ejemplo, el divisor 16:1 en las cortadoras de plasma Everlast debe tratarse como 24:1 (y 50:1 se convierte en 75:1). Esto no es un problema con marcas de mayor reputación (p. Ej., Thermal Dynamics, Hypertherm, ESAB, etc.). Entonces, si está viendo voltajes de corte más bajos de lo esperado, podría ser preferible reconfigurar el THCAD para leer el voltaje de arco bruto (asegurándose de deducir cualquier resistencia interna del valor de resistencia de escala requerido. Compare los voltajes de este método con los de entrada dividida de voltaje de arco.

Recordando que los voltajes de arco de plasma son potencialmente letales, aquí hay algunos criterios sugeridos.

.Arranque arco piloto

Debido a que no es probable que haya un EMI significativo, debe poder instalar de forma segura el THCAD en su panel de control si ha seguido nuestras pautas de construcción.

* Si no tiene un divisor de voltaje, instale resistencias de escala dentro del cortador de plasma e instale el THCAD en el panel de control o siga las sugerencias para máquinas de arranque de alta frecuencia.

* Si tiene un divisor de voltaje, instale un THCAD-10 en su panel de control. No hemos tenido problemas con esta configuración con una cortadora de plasma Thermal Dynamics de 120 amp.

.Arranque HF

Instale el THCAD en el inversor ya que la señal de frecuencia es mucho más inmune al ruido EMI

* Si no tiene un divisor de voltaje y tiene espacio dentro del cortador de plasma, instale un THCAD-300 dentro del cortador de plasma.

* Si no tiene un divisor de voltaje y no tiene espacio dentro del cortador de plasma, instale un THCAD-10 en una caja de metal fuera del cortador de plasma e instale el 50% de la resistencia de escala en cada uno de los IN + e IN- dentro la caja del cortador de plasma para que no salgan voltajes letales de la caja.

* Si tiene un divisor de voltaje, instale un THCAD-10 en una caja de metal fuera del cortador de plasma

== Postprocesadores y anidamiento

El plasma no es diferente a otras operaciones de CNC, siendo:

. Diseñado en CAD (con salidas en formato DXF o, a veces, SVG).
. Procesado en CAM para generar el código G final que se carga en la máquina
. Corta las piezas mediante comandos de código G del CNC.

Algunas personas logran buenos resultados con las herramientas de Inkscape y G-Code, pero SheetCam es una solución de muy buen precio y hay una serie de posprocesadores disponibles para Linuxcnc. SheetCam tiene una serie de características avanzadas diseñadas para el corte por plasma y, por el precio, es una obviedad para cualquiera que realice un corte por plasma regular.

== Diseñando para entornos eléctricos ruidosos

El corte por plasma es inherentemente un entorno eléctrico extremadamente hostil y ruidoso. Si tiene problemas de EMI, las cosas no funcionarán correctamente. Encender la antorcha provoca el reinicio de la computadora es un ejemplo obvio, pero puede tener cualquier número de síntomas extraños. Casi todo sucederá solo cuando la antorcha esté cortando, a menudo cuando se dispara por primera vez.

Por lo tanto, el creador del sistema debe seleccionar los componentes con cuidado y diseñar desde cero para hacer frente a este entorno hostil para evitar el impacto de la interferencia electromagnética (EMI). De lo contrario, se podrían generar innumerables horas de busqueda infructuosa de soluciones. 

Elegir placas ethernet como la Mesa 7i76e o la más barata 7i96, permiten que la PC se ubique lejos de la electrónica y la máquina de plasma. Este hardware también permite el uso de sistemas lógicos de 24 voltios que son mucho más tolerantes al ruido. Los componentes deben montarse en una carcasa metálica conectada a tierra de la red. Se recomienda encarecidamente que se instale un filtro EMI en la conexión de alimentación de red. La forma más sencilla es utilizar un conector IEC de alimentación de red con filtro EMI de uso común en PC y electrodomésticos, lo que permite lograrlo sin trabajo adicional. Planifique la disposición de los componentes en el gabinete para que la alimentación de la red, los cables del motor de alto voltaje y las señales lógicas se mantengan lo más separadas posible entre sí. Si tienen que cruzar, manténgalas a 90 grados.

Peter Wallace de Mesa Electronics sugiere; “Si tiene una fuente de plasma compatible con CNC con un divisor de voltaje, montaría el THCAD dentro de su caja electrónica con todos los demás equipos de movimiento. Si tiene una fuente de plasma manual y está leyendo voltaje de plasma sin procesar, montaría el THCAD lo más cerca posible de la fuente de plasma (incluso dentro de la caja de la fuente de plasma si cabe). En este caso, asegúrese de que todo el lado bajo Las conexiones THCAD están completamente aisladas de la fuente de plasma. Si utiliza una caja blindada para el THCAD, el escudo debe conectarse a la tierra de su caja electrónica, no a la tierra de la fuente de plasma ".

Se recomienda tender un cable de tierra separado de las cajas del motor y la antorcha de regreso a un punto central de conexión a tierra en la máquina. Conecte el cable de tierra de plasma a este punto y, opcionalmente, una varilla de tierra clavada en el suelo lo más cerca posible de la máquina (especialmente si se trata de una máquina de plasma de arranque HF).

El cableado externo a los motores debe estar blindado y dimensionado adecuadamente para manejar la corriente que pasa por el circuito. El protector debe dejarse desconectado en el extremo del motor y conectado a tierra en el extremo de la caja de control. Considere usar un pin adicional en cualquier conector en la caja de control para que la tierra pueda extenderse hasta la caja de control y conectarse a tierra al chasis directamente en el controlador del motor paso a paso / servo.

Somos conscientes de que al menos un constructor de sistemas comerciales ha tenido problemas con el ruido eléctrico inducido en el circuito de detección óhmico. Si bien esto puede mitigarse utilizando ferritas y enrollando el cable, también se recomienda agregar un filtro de alimentación a través de la línea de alimentación donde la señal de detección óhmica ingresa al gabinete de la electrónica.

Tommy Berisha, el maestro de la construcción de máquinas de plasma con un presupuesto limitado, dice: “Si tiene un presupuesto limitado, considere usar viejos bloques de energía para computadoras portátiles. Son muy buenos, el filtrado es bueno, completamente aislado, limitado por la corriente (esto se vuelve muy importante cuando algo sale mal), y ajustar 2 o 3 de ellos en serie es fácil ya que están aislados (tenga en cuenta que algunos tienen la conexión a tierra) a la terminal de salida negativa y tiene que ser desconectado, simplemente haciendo uso de un cable de alimentación sin contactos a tierra)".

== Mesas de agua

El nivel mínimo de agua debajo del nivel de corte de la antorcha debe ser de alrededor de 40 mm, tener espacio debajo de los listones es agradable para que el agua pueda nivelarse y escapar durante el corte, tener un poco de agua sobre la placa de metal que se está cortando es realmente agradable en la medida que se deshace del polvo, dejarlo sumergido es la mejor manera, pero no es preferible para sistemas con uso a tiempo parcial, ya que corroerá la antorcha. Agregar bicarbonato de sodio al agua mantendrá la mesa en buenas condiciones durante muchos años, ya que no permite la corrosión mientras los listones están bajo el agua y también reduce el olor a vapor de agua. Algunas personas construyen un tanque de agua con una entrada de aire comprimido para poder enviar el agua desde el tanque hasta la mesa a demanda y así permitir cambios en los niveles de agua.

== Mesas de tiro descendente

Muchas mesas comerciales utilizan un diseño de tiro descendente, en las que se utilizan ventiladores para aspirar el aire a través de los listones para capturar humos y chispas. A menudo, las mesas se dividen en zonas, por lo que solo una sección debajo de la antorcha se abre a la ventilación de salida, a menudo utilizando cámaras de aire y solenoides de aire para abrir las persianas. Disparar estas zonas es relativamente sencillo si utiliza la posición de la articulación o el eje desde uno de los pines de movimiento y el componente lincurve para asignar zonas de tiro descendente al pin de salida correcto.

== Diseñando para velocidad y aceleración

En el corte por plasma, la velocidad y la aceleración son el rey. Cuanto mayor es la aceleración, menos necesita reducir la velocidad de la máquina al negociar curvas. Esto implica que el pórtico debe ser lo más ligero posible sin sacrificar la rigidez torsional. Una sección de caja de aluminio de 100 mm x 100 mm x 2 mm tiene una rigidez torsional equivalente a una extrusión de ranura en T de 80 mm x 80 mm pero es 62% más liviana. Entonces, ¿la conveniencia de las ranuras en T supera la construcción adicional?

== Distancia recorrida por revolución del motor

Los motores paso a paso sufren de resonancia y un piñón de accionamiento directo probablemente significa que el motor está funcionando en condiciones desfavorables. Idealmente, para máquinas de plasma, una distancia de alrededor de 15-25 mm por revolución del motor se considera ideal, pero incluso alrededor de 30 mm por revolución sigue siendo aceptable. Un tornillo de bola de paso de 5 mm con una unidad de reducción de 3:1 o 5:1 es ideal para el eje Z.

== Configuración de plasma PlasmaC en LinuxCNC 

La <<cha:plasmac-user-guide,configuración de PlasmaC>>, que se compone de un componente HAL (plasmac.hal) más configuraciones completas para Axis y Gmoccapy ha recibido una contribución considerable de muchos en el movimiento de código abierto LinuxCNC que han avanzado la comprensión de los controladores de plasma desde aproximadamente 2015. Se han realizado muchas pruebas y trabajos de desarrollo para llevar a PlasmaC a su estado de funcionamiento actual. Se ha incluido todo, desde el diseño del circuito hasta el control y la configuración del código G. Además, PlasmaC admite THC externos como el Proma 150, pero realmente se destaca cuando se combina con un controlador Mesa, ya que esto permite que el integrador incluya el convertidor de voltaje a frecuencia Mesa THCAD, diseñado específicamente para lidiar con el entorno de plasma hostil.

PlasmaC está diseñado para ser autónomo e incluye la capacidad de incluir sus tablas de corte, pero también incluye funciones para ser utilizadas con un postprocesador como SheetCam.

No hay duda de que una vez que el sistema PlasmaC ingrese a las ramas principales de Linuxcnc, definirá el soporte de plasma de LinuxCNC durante muchos años, ya que incluye todas las características de un sistema de control de plasma de alta gama patentado a un precio de código abierto.

== Postprocesadores para corte por plasma

Los programas CAM (Fabricación asistida por computadora) son el puente entre CAD (Diseño asistido por computadora) y la operación final del CNC (Control numérico por computadora). A menudo incluyen un postprocesador configurable por el usuario para definir el código que se genera para una máquina o dialecto específico de G-Code.

Muchos usuarios de Linuxcnc están perfectamente contentos con el uso de Inkscape para convertir archivos basados en vectores .SVG a G-Code. Si está utilizando un plasma para hobby o uso doméstico, considere esta opción. Sin embargo, si sus necesidades son más complejas, probablemente la mejor y más razonable solución sea SheetCam. SheetCam es compatible con Windows y Linux y hay disponibles procesadores posteriores, incluida la configuración de PlasmaC. SheetCam le permite anidar partes sobre una hoja completa de material y le permite configurar conjuntos de herramientas y fragmentos de código para satisfacer sus necesidades. Los postprocesadores SheetCam son archivos de texto escritos en el lenguaje de programación Lua y, en general, son fáciles de modificar para adaptarse a sus requisitos exactos. Para obtener más información, consulte https://sheetcam.com [sitio web de SheetCam] y su foro de soporte.

Se incluye otro postprocesador popular con el popular paquete Fusion360, pero los postprocesadores incluidos necesitarán cierta personalización.

LinuxCNC es una aplicación CNC y las discusiones sobre técnicas CAM distintas a esta discusión introductoria están fuera del alcance de LinuxCNC.

